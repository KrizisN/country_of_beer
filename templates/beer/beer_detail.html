{% extends "beer/base.html" %}
{% block content %}
{% load static i18n %}
<div class="row">
    {% for image in beer.beershots_set.all %}
    <div>
        <img class="size-for-images" src="{{ image.image.url }}" alt="Card image cap">
    </div>
    {% endfor %}
</div>
<br>
<div class="row justify-content-center">
    <div class="jumbotron col-8">
        <div class="container">
            <h1 class="display-4">{% trans "Описание:" %}</h1>
            <p class="lead">{{ beer.discriptions|safe }}</p>
            <br>
            <p class="lead">{% trans "Производитель:" %}
                {% for manufacturer in beer.manufacturer.all %}
                <a href="{% url 'manufacturer_detail' manufacturer.name %}">
                    {{ manufacturer.name }}
                </a>
                {% endfor %}
            </p>
        </div>
    </div>
    <div class="card right col-3">
        <img class="card-img-top" src="{{ beer.image.url }}" alt="Card image cap">
        <div class="card-body">
            <p class="card-text nicefond">{{ beer.name }}</p>
        </div>
        <ul>
            <li>
                <form action="{% url 'add_rating' %}" method="post" name="rating">
                    <b>{% trans "Рейтинг:" %}</b>
                    {% csrf_token %}
                    <input type="hidden" value="{{ beer.id }}" name="beer">
                    <span class="rating">
                        {% for k, v in star_form.fields.star.choices %}
                            <input id="rating{{ v }}" type="radio" name="star"
                                   value="{{ k }}">
                            <label for="rating{{ v }}">{{ k }}</label>
                        {% endfor %}
                    </span>
                </form>
            </li>
        </ul>
    </div>
</div>
<br>
{% if user.is_authenticated %}
    <form action="{% url 'add_review' beer.id %}" method="post" id="formReview">
        {% csrf_token %}
        <input type="hidden" name="parent" id="contactparent" value="">
        <div class="container">
            <div class="row">
                <div class="form-group col-md-12 m-3">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            {% trans "Комментарии" %}
                        </div>
                        <div class="panel-body comments">
                            {{ form.text }}
                            <br>
                            <a class="small pull-left" href="#">{% trans "Войти или зарегистрироваться" %}</a>
                            <button type="submit" class="btn btn-info pull-right">{% trans "Отправить" %}</button>
                            <div class="clearfix"></div>
                            <hr>
                            {{ form.captcha }}
                            {% for review in beer.get_review %}
                            <ul class="media-list">
                                <li class="media">
                                    <div class="comment">
                                        <a href="#" class="pull-left">
                                            {% if review.user.profile.image %}
                                            <img class="card" width="100" height="100"
                                                 src="{{ review.user.profile.image.url }}"
                                                 alt=""
                                                 class="img-circle">
                                            {% else %}
                                            <img class="card" width="100" height="100"
                                                 src="{% static 'images/anonim.png' %}"
                                                 alt=""
                                                 class="img-circle">
                                            {% endif %}
                                        </a>
                                        <div class="media-body">
                                            <strong class="text-success">{{ review.user }}</strong>
                                            <span class="text-muted">
     <small class="text-muted">{{ user.get_email }}</small>
     </span>
                                            <p>
                                                {{ review.text }}
                                            </p>
                                        </div>
                                        <a href="#formReview" onclick="addReview('{{ review.name }}', '{{ review.id }}')">
                                            {% trans "Ответить" %}</a>
                                        <div class="clearfix"></div>
                                        {% for rev in review.reviews_set.all %}
                                        <ul class="media-list">
                                            <li class="media">
                                                <div class="comment">
                                                    <a href="#" class="pull-left">
                                                        <img src="https://bootstraptema.ru/snippets/element/2016/comments/com-2.jpg"
                                                             alt="" class="img-circle">
                                                    </a>
                                                    <div class="media-body">
                                                        <strong class="text-success">{{ rev.name }}</strong>
                                                        <span class="text-muted">
     <small class="text-muted">{{ rev.email }}</small>
     </span>
                                                        <p>
                                                            {{ rev.text }}
                                                        </p>
                                                    </div>
                                                    <div class="clearfix"></div>
                                                </div>
                                            </li>
                                        </ul>
                                        {% endfor %}
                                    </div>
                                </li>
                            </ul>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
{% else %}
<div class="container">
    <strong>Для отправки отзывов Вам необхадимо авторизироваться</strong>
</div>
{% endif %}
<script>
    function addReview(name, id) {
        document.getElementById("contactparent").value = id;
        document.getElementById("contactcomment").innerText = `${name}, `
    }


</script>

{% endblock content %}
</body>
</html>